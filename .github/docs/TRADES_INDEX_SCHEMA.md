# Trades Index Schema Documentation

This document describes the extended schema for `trades-index.json` including new optional fields for advanced features.

## Overview

The trades index is the central data structure that powers all analytics, charts, and trade listings in SFTi-Pennies. It is automatically generated by parsing trade markdown files.

## Schema Version

Current version: **2.0** (Extended)

Previous version: **1.0** (Basic)

**Backward Compatibility**: Version 2.0 adds optional fields only. All version 1.0 trades remain valid.

## Required Fields

Every trade must have these fields:

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `trade_number` | integer | Unique sequential identifier | `1` |
| `ticker` | string | Stock symbol | `"AAPL"` |
| `direction` | string | "Long" or "Short" | `"Long"` |
| `entry_date` | string | ISO 8601 timestamp | `"2025-01-15T09:30:00"` |
| `exit_date` | string | ISO 8601 timestamp | `"2025-01-15T15:45:00"` |
| `entry_price` | number | Entry price per share | `150.00` |
| `exit_price` | number | Exit price per share | `155.00` |
| `position_size` | integer | Number of shares | `100` |
| `pnl_usd` | number | Profit/loss in USD | `500.00` |
| `pnl_percent` | number | Profit/loss percentage | `3.33` |

## Optional Fields (New in v2.0)

These fields enhance analytics and organization:

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `strategy` | string | Trading strategy name | `"Gap and Go"` |
| `tags` | array or string | Categories/tags | `["scalp", "momentum"]` |
| `r_multiple` | number | R-multiple (P&L / initial risk) | `2.5` |
| `images` | array | Screenshot references | See below |
| `stop_loss` | number | Stop loss price | `148.00` |
| `target_price` | number | Target price | `156.00` |
| `risk_reward_ratio` | number | Risk:Reward ratio | `3.0` |
| `time_in_trade_hours` | number | Duration in hours | `6.25` |
| `notes` | string | Additional notes | `"Strong momentum..."` |
| `file_path` | string | Path to markdown file | `"index.directory/SFTi.Tradez/week.0003/2025.01.15.AAPL.long.md"` |

## Images Array Schema

The `images` field allows attaching multiple screenshots to a trade:

```json
{
  "images": [
    {
      "path": "/index.directory/assets/trade-media/001/entry.png",
      "type": "entry",
      "caption": "Entry setup showing breakout"
    },
    {
      "path": "/index.directory/assets/trade-media/001/exit.png",
      "type": "exit",
      "caption": "Exit at target price"
    }
  ]
}
```

**Image Types**:
- `entry` - Entry point screenshot
- `exit` - Exit point screenshot
- `setup` - Pre-trade setup analysis
- `intraday` - Intraday progression
- `notes` - Annotated chart with notes

## Complete Example

```json
{
  "trades": [
    {
      "trade_number": 1,
      "ticker": "AAPL",
      "direction": "Long",
      "entry_date": "2025-01-15T09:30:00",
      "exit_date": "2025-01-15T15:45:00",
      "entry_price": 150.00,
      "exit_price": 155.00,
      "position_size": 100,
      "pnl_usd": 500.00,
      "pnl_percent": 3.33,
      "strategy": "Gap and Go",
      "tags": ["scalp", "momentum", "gap-up"],
      "r_multiple": 2.5,
      "images": [
        {
          "path": "/index.directory/assets/trade-media/001/entry.png",
          "type": "entry",
          "caption": "Entry setup showing gap and volume surge"
        },
        {
          "path": "/index.directory/assets/trade-media/001/exit.png",
          "type": "exit",
          "caption": "Exit at target with resistance rejection"
        }
      ],
      "stop_loss": 148.00,
      "target_price": 156.00,
      "risk_reward_ratio": 3.0,
      "time_in_trade_hours": 6.25,
      "notes": "Strong pre-market momentum. Gapped up on earnings news. Entered on first pullback with volume confirmation.",
      "file_path": "index.directory/SFTi.Tradez/week.0003/2025.01.15.AAPL.long.md"
    }
  ],
  "statistics": {
    "total_trades": 1,
    "winning_trades": 1,
    "losing_trades": 0,
    "win_rate": 1.0,
    "total_pnl": 500.00,
    "avg_pnl": 500.00,
    "avg_winner": 500.00,
    "avg_loser": 0,
    "largest_win": 500.00,
    "largest_loss": 0,
    "total_volume": 100
  },
  "version": "2.0",
  "generated_at": "2025-01-18T12:00:00.000000"
}
```

## Backward Compatibility

**Version 1.0 trades** (without optional fields) remain fully compatible:

```json
{
  "trade_number": 1,
  "ticker": "AAPL",
  "direction": "Long",
  "entry_date": "2025-01-15T09:30:00",
  "exit_date": "2025-01-15T15:45:00",
  "entry_price": 150.00,
  "exit_price": 155.00,
  "position_size": 100,
  "pnl_usd": 500.00,
  "pnl_percent": 3.33
}
```

All scripts handle missing optional fields gracefully:
- `generate_analytics.py` - Uses defaults (empty arrays, null values)
- `generate_charts.py` - Skips optional visualizations
- Analytics dashboard - Displays "N/A" for missing data

## Migration Guide

To upgrade existing trades to v2.0:

### 1. Add Strategy Field

Edit markdown frontmatter:

```yaml
---
trade_number: 1
ticker: AAPL
strategy: Gap and Go  # ADD THIS
---
```

### 2. Add Tags

```yaml
---
trade_number: 1
ticker: AAPL
tags: [scalp, momentum, gap-up]  # ADD THIS
---
```

### 3. Add Images

1. Place screenshots in `index.directory/assets/trade-media/{trade_number}/`
2. Add to frontmatter:

```yaml
---
trade_number: 1
ticker: AAPL
images:
  - path: /index.directory/assets/trade-media/001/entry.png
    type: entry
    caption: Entry setup
  - path: /index.directory/assets/trade-media/001/exit.png
    type: exit
    caption: Exit point
---
```

### 4. Re-parse Trades

Run the parser to update the index:

```bash
python .github/scripts/parse_trades.py
```

## Validation

Validate your trades-index.json against the schema:

```bash
# Using Python jsonschema library
pip install jsonschema
python -c "
import json
import jsonschema

with open('trades-index-schema.json') as f:
    schema = json.load(f)

with open('index.directory/trades-index.json') as f:
    data = json.load(f)

jsonschema.validate(data, schema)
print('âœ… Schema validation passed!')
"
```

## Best Practices

1. **Strategy naming**: Use consistent strategy names for better analytics
2. **Tag taxonomy**: Establish a standard set of tags
3. **Image storage**: Follow the [Media Spec](.github/docs/MEDIA_SPEC.md)
4. **R-multiple**: Calculate accurately for position sizing insights
5. **Notes**: Document lessons learned and trade rationale

## Future Extensions

Planned additions for v3.0:

- `commission` - Trading fees
- `slippage` - Price slippage on entry/exit
- `market_condition` - Market environment tags
- `emotions` - Emotional state tracking
- `ai_analysis` - AI-generated insights
- `related_trades` - Links to similar trades

See [ROADMAP.md](ROADMAP.md) for details.
